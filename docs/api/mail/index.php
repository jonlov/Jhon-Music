<?php function throwError($message){ header('HTTP/1.0 400 Bad Request'); die($message); } if($_SERVER['REQUEST_METHOD'] == 'POST'){ require 'PHPMailerAutoload.php'; $name = htmlspecialchars($_POST['name']); $email = htmlspecialchars($_POST['email']); $message = htmlspecialchars($_POST['message']); if(preg_match( "/[\r\n]/", $data['name']) || preg_match( "/[\r\n]/", $data['email']) || preg_match( "/[\r\n]/", $data['message'])) throwError('Error.'); if(count($data['message']) >= 30) throwError('Message should be at least 30 characteres.'); if($name == '' || $email == '' || $message == '') throwError('All the fields are required.'); if(!filter_var($email, FILTER_VALIDATE_EMAIL)) throwError('Invalid email'); $mail = new PHPMailer; $mail->SMTPDebug = 0; $mail->isSMTP(); $mail->Host = 'cpanel-006-slc.hostingww.com'; $mail->SMTPAuth = true; $mail->Username = 'no-reply@jhonmusic.com'; $mail->Password = 'B+x7qB1VTP?V'; $mail->SMTPSecure = 'tls'; $mail->Port = 587; $mail->setFrom('no-reply@jhonmusic.com', $name . ' - JhonMusic.com'); $mail->addAddress('Jhon.contrataciones@gmail.com', $name); $mail->isHTML(true); $mail->Subject = 'Mensaje de ' . $name; $mail->Body = '<b>Nombre: </b>'. $name .'<br /> <b>Email: </b>'. $email . '<br /> <b>Mensaje: </b>'. $message; $mail->AltBody = 'Nombre: '. $name .' | Email: '. $email .' | Mensaje: '. $message; if(!$mail->send()) { throwError('Message could not be sent.'); } else { echo 'Message has been sent'; } } else { throwError('Bad request.'); } ?>